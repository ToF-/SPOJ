REQUIRE random.fs
REQUIRE parser.fs

CHAR 0 CONSTANT SQUARE
CHAR 1 CONSTANT PAWN


32000 CONSTANT MAX-GAME-LENGTH

MAX-GAME-LENGTH VALUE GAME-LENGTH

CREATE GAME MAX-GAME-LENGTH ALLOT

: INIT-WINNING
    GAME GAME-LENGTH SQUARE FILL
    PAWN GAME GAME-LENGTH 2/ + C! ;

S" 001" 2CONSTANT RIGHT-TAKE
S" 100" 2CONSTANT LEFT-TAKE

S" 110" 2CONSTANT BEFORE-RIGHT-TAKE
S" 011" 2CONSTANT BEFORE-LEFT-TAKE

RIGHT-TAKE STR-P CONSTANT RIGHT-TAKE-P
LEFT-TAKE  STR-P CONSTANT LEFT-TAKE-P

: RANDOM-FLAG
    2 RANDOM ;

: STR++ ( str,sc -- str+1,sc-1 )
    1- SWAP 1+ SWAP ;

: SEARCH-TAKE ( str,sc,xt -- str,sc,f )
    >R
    BEGIN
        DUP IF
            R@ EXECUTE 0=
        ELSE
            FALSE
        THEN
        WHILE
        STR++
    REPEAT R> DROP ;

: REPLACE-WITH-TAKE ( str,sc,xt,pat,pc -- )
    2>R SEARCH-TAKE IF
        3 - 2R> ROT SWAP \ pat,str-3,pc
        CMOVE
    ELSE
        2DROP DROP
    THEN ;






