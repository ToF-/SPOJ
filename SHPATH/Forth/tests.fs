REQUIRE ffl/tst.fs
REQUIRE shpath.fs

HEAP-ALLOCATE HEAP-INIT
4807    0 S" foo" CREATE-RECORD
2317 SWAP S" bar" CREATE-RECORD
DUP RECORD-NAME COUNT S" bar" ?STR
DUP RECORD-INDEX 2317 ?S
RECORD-LINK
DUP RECORD-NAME COUNT S" foo" ?STR
    RECORD-INDEX 4807 ?S

S" amiens" HASH-KEY .
S" paris" HASH-KEY .

CREATE TEST-KEYS /HASH-TABLE ALLOT
CREATE LINE-BUFFER 256 ALLOT

: FILL-TABLE
    S" test/communes.txt" R/O OPEN-FILE THROW
    >R
    BEGIN
        LINE-BUFFER 256 R@ READ-LINE THROW WHILE
        DUP IF
            LINE-BUFFER SWAP HASH-KEY TEST-KEYS + DUP C@ 1+ SWAP C!
        ELSE
            DROP
        THEN
    REPEAT
    R> CLOSE-FILE THROW ;

: .TABLE
    0 /HASH-TABLE 0 DO TEST-KEYS I + C@ DUP . + LOOP
    CR . ." keys" ;


FILL-TABLE
.TABLE
HEAP-FREE
BYE
